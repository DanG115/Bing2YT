!function(){"use strict";const e={developerMode:!1,redirectEnabled:!1,observers:{redirect:null,ytIcon:null}},t={searchForm:".b_searchboxForm",inputBox:"#sb_form_q",videoTitle:"div.title[href*='youtube.com']",videoLink:"a[href*='youtube.com'], a.source.tosurl",embeddedIframe:"iframe[src*='youtube.com/embed/'], div.ep iframe[src*='youtube.com']",viewSource:"action view_source  nofocus",videoResult:".dg_u, .vrhdata, [data-bm]"},o="https://www.youtube.com/watch?v=",n="https://www.youtube.com/results?search_query=",r=(...t)=>{e.developerMode},i=()=>location.href.includes("/riverview/")||location.href.includes("/watch/")||location.href.includes("view=detail");let c;const s=async()=>{const e=document.getElementById("yt-search-btn"),o=document.getElementById("yt-search-btn-sl"),n=document.querySelector(t.searchForm),i=document.querySelector(t.inputBox);if(n&&i){const t=await new Promise(e=>{chrome.storage.sync.get(["ytIconVersion"],t=>{e(t?.ytIconVersion)})})??"button",s=!!document.getElementById("yt-search-btn"),a=!!document.getElementById("yt-search-btn-sl");if(c===t&&("button"===t&&s||"icon"===t&&a))return void r();e&&e.remove(),o&&o.remove(),"button"===t?n.insertBefore(d(),i.nextSibling):"icon"===t&&n.insertBefore(l(),i.nextSibling),c=t,r()}else r()},d=()=>{const e=document.createElement("button");return e.id="yt-search-btn",e.innerHTML='\n    <svg style="vertical-align:middle;margin-right:6px" width="16" height="16" viewBox="0 0 24 24">\n      <path fill="currentColor" d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>\n    </svg>\n    Search on YouTube',Object.assign(e.style,{marginLeft:"8px",padding:"6px 12px",backgroundColor:"#fff",color:"#FF0000",border:"1px solid rgba(255, 0, 0, 0.4)",borderRadius:"20px",cursor:"pointer",fontSize:"13px",fontWeight:"500",marginTop:"8px",display:"inline-flex",alignItems:"center",transition:"all 0.25s ease",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"}),e.type="button",e.onmouseover=()=>{e.style.backgroundColor="#FF0000",e.style.color="#fff",e.style.borderColor="#FF0000"},e.onmouseout=()=>{e.style.backgroundColor="#fff",e.style.color="#FF0000",e.style.borderColor="rgba(255, 0, 0, 0.4)"},e.onclick=()=>{const e=document.querySelector(t.inputBox)?.value.trim();e&&e.length>0&&(r(),window.location.href=`${n}${encodeURIComponent(e)}`)},e},l=()=>{const e=document.createElement("button");e.id="yt-search-btn-sl",e.type="button",e.setAttribute("aria-label","Search on YouTube"),e.className="sb_icon",e.innerHTML='\n    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">\n      <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>\n    </svg>\n  ',Object.assign(e.style,{display:"inline-flex",alignItems:"center",justifyContent:"center",verticalAlign:"middle",width:"32px",height:"32px",padding:"0",marginLeft:"6px",background:"transparent",border:"none",cursor:"pointer"});const o=e.querySelector("svg");return Object.assign(o.style,{display:"block",width:"18px",height:"18px",fill:"#E6E5E6",opacity:"0.85",pointerEvents:"none"}),e.addEventListener("mouseenter",()=>{o.style.opacity="1"}),e.addEventListener("mouseleave",()=>{o.style.opacity="0.85"}),e.onclick=()=>{const e=document.querySelector(t.inputBox)?.value.trim();e&&(r(),window.location.href=`${n}${encodeURIComponent(e)}`)},e},a=()=>{const e=document.getElementById("bing2yt-toast");e&&e.remove();const t=document.createElement("div");t.id="bing2yt-toast",t.textContent="Redirecting to YouTube video!",Object.assign(t.style,{position:"fixed",top:"0",left:"0",width:"100%",backgroundColor:"#FF0000",color:"white",fontSize:"15px",fontWeight:"600",textAlign:"center",padding:"10px 0",zIndex:"9999",opacity:"0",transform:"translateY(-100%)",transition:"all 0.4s ease"}),document.body.appendChild(t),requestAnimationFrame(()=>{t.style.opacity="1",t.style.transform="translateY(0)"}),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(-100%)",setTimeout(()=>t.remove(),500)},3e3)};let u=0,m=null,y=null;const p=n=>{if(r(),!e.redirectEnabled||!i())return;if(e.redirectingNow)return void r();if(u>=10)return void r();const c=document.querySelector(t.embeddedIframe);if(c&&y===window.location.href&&m===c.src)r();else{if(u++,r(),c){const t=(e=>{try{const t=decodeURIComponent(e).match(/(?:embed\/|v=|youtu\.be\/)([\w-]{11})/);return t?t[1]:null}catch{return null}})(c.src);t&&(y=window.location.href,m=c.src,r(),e.redirectingNow=!0,chrome.storage.sync.get(["ytRedirectOption"],e=>{if("page"===e.ytRedirectOption)chrome.runtime.sendMessage({action:"openBing2YT",videoId:t});else{if("toast"!==e.ytRedirectOption)return r(),a(),void(window.location.href=`${o}${t}`);a(),window.location.href=`${o}${t}`}}))}if(u<10&&(r(),setTimeout(()=>p(),800)),"click"===n?.type){const o=n.target.closest(t.videoResult);if(!o)return;const i=o.querySelector(t.videoLink);if(i?.dataset.instInfo)try{const t=JSON.parse(i.dataset.instInfo),o=t.url?decodeURIComponent(t.url):null;o&&o.includes("youtube.com")&&(r(),e.redirectingNow=!0,a(),y=window.location.href,m=null,n.preventDefault(),window.location.replace(o))}catch(e){r()}}}};let b=0;const v=()=>{e.observers.redirect?.disconnect(),p(),e.observers.redirect=new MutationObserver(e=>{const o=Date.now();if(o-b<700)r();else if(b=o,window.location.href.startsWith("https://www.bing.com/videos/onecolumn/landing"))r();else for(const o of e)for(const e of o.addedNodes)if(1===e.nodeType&&e.matches(t.embeddedIframe))return void p()}),e.observers.redirect.observe(document,{childList:!0,subtree:!0})},f=300,h=200,g="320px";let w=null;const x=async(e,t)=>{if(e.href.includes("youtube.com"))try{w||(w=(()=>{const e=document.createElement("div");return e.id="yt-preview-tooltip",Object.assign(e.style,{position:"fixed",zIndex:"999999",background:"#1f1f1f",color:"#fff",padding:"8px",borderRadius:"8px",maxWidth:g,display:"none",opacity:"0",transition:`opacity ${h}ms ease`}),document.body.appendChild(e),e})());const o=`https://www.youtube.com/oembed?url=${encodeURIComponent(e.href)}&format=json`,n=await fetch(o);if(!n.ok)return;const r=await n.json();w.innerHTML=`\n      <div style="display:flex;gap:8px;">\n        <img src="${r.thumbnail_url}" width="100" style="border-radius:6px" />\n        <div>\n          <div style="font-weight:600">${r.title}</div>\n          <div style="font-size:12px;color:#ccc">${r.author_name}</div>\n        </div>\n      </div>\n    `,E(t),w.style.display="block",requestAnimationFrame(()=>{w.style.opacity="1"})}catch{}},E=e=>{w&&(w.style.top=`${e.clientY+15}px`,w.style.left=`${e.clientX+15}px`)};let I=null;const L=()=>{document.addEventListener("mouseover",e=>{const o=e.target?.closest(t.videoTitle);o&&(o.removeAttribute("title"),I&&clearTimeout(I),I=window.setTimeout(()=>x(o,e),f))}),document.addEventListener("mousemove",e=>{w&&"block"===w.style.display&&E(e)}),document.addEventListener("mouseout",e=>{const o=e.target?.closest(t.videoTitle);o&&(I&&clearTimeout(I),w&&(w.style.opacity="0",setTimeout(()=>{w&&(w.style.display="none")},h)))})},S=()=>{r(),e.observers.ytIcon?.disconnect();const o=()=>{document.querySelectorAll(t.viewSource).forEach(e=>{e.classList.contains("yt-replaced")||(e.innerHTML='\n          <span class="yt-icon">\n            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" \n              viewBox="0 0 24 24" fill="currentColor">\n              <path d="M19.615 3.184C21.239 3.53 22.488 4.857 22.837 6.524c.376 1.803.376 5.563.376 5.563s0 3.76-.376 5.563c-.349 1.667-1.598 2.994-3.222 3.34C17.5 21.5 12 21.5 12 21.5s-5.5 0-7.615-.33C2.761 20.824 1.512 19.497 1.163 17.83.787 16.027.787 12.267.787 12.267s0-3.76.376-5.563C1.512 4.857 2.761 3.53 4.385 3.184 6.5 2.854 12 2.854 12 2.854s5.5 0 7.615.33zM10 15.5l6-3.5-6-3.5v7z"/>\n            </svg>\n          </span>',e.classList.add("yt-replaced"),r())})};e.observers.ytIcon=new MutationObserver(o),e.observers.ytIcon.observe(document.body,{childList:!0,subtree:!0}),o(),r()},T=()=>{if(window.location.href.includes("bing.com/videos"))if(i()){document.addEventListener("click",p,{capture:!0}),v();document.querySelector(t.viewSource)?S():r(),r()}else{s(),v(),L();document.querySelector(t.viewSource)?S():r(),r()}},C=()=>{document.removeEventListener("click",p),e.observers.redirect?.disconnect(),e.observers.ytIcon?.disconnect(),document.getElementById("yt-search-btn")?.remove(),w&&(w.remove(),w=null),e.redirectingNow=!1,document.querySelectorAll(".yt-replaced").forEach(e=>{e.classList.remove("yt-replaced"),e.innerHTML=""}),r()};chrome.runtime.onMessage.addListener(t=>{"TOGGLE_REDIRECT"===t.type&&(e.redirectEnabled=t.enabled,t.enabled?T():C())}),chrome.storage.sync.get(["redirectEnabled","devMode"],t=>{e.redirectEnabled=!!t.redirectEnabled,e.developerMode=!!t.devMode,e.redirectEnabled&&T()})}();
